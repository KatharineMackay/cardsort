<!-- PAGE 3: Final Sort and Submit -->
<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Final Waste Sort</title>
  <style>
    /* your existing styles */
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>
  <h1>Sort Waste Topics by Importance</h1>
  <p style="text-align:center;">...then click <strong>Submit</strong>.</p>
  <ol id="sortable">
    <!-- list items -->
  </ol>
  <button id="submit-btn">Submit</button>

  <!-- Hidden form to submit to Google Forms -->
  <form id="hidden-form"
        action="https://docs.google.com/forms/d/e/1bq4GMn4rs_uoLr2UpsY_GK0rypVLFsoO344CbZQTC-E/formResponse"
        method="POST" target="hidden_iframe" style="display:none;">
    <input type="hidden" name="entry.898622384" id="entry-field" value="" />
  </form>
  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <script>
    Sortable.create(document.getElementById("sortable"), { animation:150 });

    document.getElementById("submit-btn").addEventListener("click", () => {
      const sorted = [...document.querySelectorAll("#sortable li")].map(el => el.textContent.trim());
      localStorage.setItem("page3result", JSON.stringify(sorted));

      const combined = {
        page1: { result: JSON.parse(localStorage.getItem("page1result") || "{}"), comments: localStorage.getItem("page1comments") || "" },
        page2: { result: JSON.parse(localStorage.getItem("page2result") || "{}"), comments: localStorage.getItem("page2comments") || "" },
        page3: { result: sorted, comments: localStorage.getItem("page3comments") || "" }
      };

      document.getElementById("entry-field").value = JSON.stringify(combined);
      document.getElementById("hidden-form").submit();

      setTimeout(() => {
        window.location.href = "thankyou.html";
        localStorage.clear();
      }, 1000);
    });
  </script>
</body>
</html>
