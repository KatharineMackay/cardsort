<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Final Waste Sort</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    ol {
      max-width: 600px;
      margin: 20px auto;
      padding: 0;
      list-style-position: inside;
    }
    li {
      background: #fff;
      padding: 12px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      cursor: grab;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 14px 24px;
      font-size: 1.2rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Sort Waste Topics by Importance</h1>
  <p style="text-align: center;">
    Drag to reorder the topics from most to least important to you, then click <strong>Submit</strong>.
  </p>

  <ol id="sortable">
    <li>What goes in what bin</li>
    <li>Where to dispose of tricky items</li>
    <li>Recycling centre near you</li>
    <li>Bin schedule in your area</li>
    <li>Shop for less waste tips</li>
    <li>Reuse & Repurpose tips</li>
    <li>Common waste mistakes</li>
    <li>Tips to reduce your household waste</li>
    <li>Waste incentives in your area</li>
    <li>Weight limit for bins</li>
    <li>Information on the impact of waste</li>
    <li>How you can make a difference</li>
    <li>Printable waste sorting chart</li>
  </ol>

  <button id="submit-btn" type="submit">Submit</button>

  <!-- Hidden form to submit data to Google Form -->
  <form
    id="hidden-form"
    action="https://docs.google.com/forms/d/e/1bq4GMn4rs_uoLr2UpsY_GK0rypVLFsoO344CbZQTC-E/formResponse"
    method="POST"
    target="hidden_iframe"
    style="display:none;"
  >
    <input type="hidden" name="entry.898622384" id="entry-field" value="" />
  </form>
  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    Sortable.create(document.getElementById("sortable"), {
      animation: 150,
    });

    document.getElementById("submit-btn").addEventListener("click", () => {
      // Get the sorted topics from page 3
      const sortedItems = [...document.querySelectorAll("#sortable li")].map(el =>
        el.textContent.trim()
      );

      // Save the sorted order to localStorage (optional)
      localStorage.setItem("page3sort", JSON.stringify(sortedItems));

      // Retrieve results and comments from pages 1 and 2
      const page1result = localStorage.getItem("page1result") || "{}";
      const page1comments = localStorage.getItem("page1comments") || "";

      const page2result = localStorage.getItem("page2result") || "{}";
      const page2comments = localStorage.getItem("page2comments") || "";

      // Combine all results into one object
      const combinedData = {
        page1: { result: JSON.parse(page1result), comments: page1comments },
        page2: { result: JSON.parse(page2result), comments: page2comments },
        page3: { result: sortedItems, comments: "" },
      };

      // Convert to JSON string
      const combinedString = JSON.stringify(combinedData);

      // Put the JSON string into the hidden input field
      document.getElementById("entry-field").value = combinedString;

      // Submit the hidden form (which posts to Google Form)
      document.getElementById("hidden-form").submit();

      // Redirect to thank you page after 1.5 seconds (adjust as needed)
      setTimeout(() => {
        window.location.href = "thankyou.html";
      }, 1500);
    });
  </script>
</body>
</html>
